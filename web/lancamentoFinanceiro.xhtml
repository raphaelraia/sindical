<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <h:head>
        <title>Sindical - Lançamento Financeiro</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;}
            .ui-button { padding: 3px!important; }

            .column00 {

            }

            .column01 {
                text-align: right
            }

            .ui-spotlight {
                z-index: 9999;
            }
        </style>

        <script type="text/javascript">
            // BLOQUEIA ENTER
            // DESABILITA ENTER
            // DISABLED ENTERCentro Custo
            // VERIFICA SE OQ ESTOU DIGITANDO É STRING
            function stopRKey(evt) {
                var evt = (evt) ? evt : ((event) ? event : null);
                //var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
                if (evt.keyCode === 13) {
                    return false;
                }
            }

            document.onkeypress = stopRKey;

        </script>
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                    <ui:include src="templates/templateStatus.xhtml"/>
                    <ui:include src="templates/templateAcessoFilial.xhtml"/>
                </f:subview>
                <f:view>
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                        <h:outputText value="Lançamento Financeiro" styleClass="fonteHeader" />
                        <div class="clear"></div>
                        <h:form id="form_lf">    

                            <p:panel id="i_panel_lancamento" styleClass="fundoCinza">

                                <h:panelGrid id="i_panel_search" columns="2" style="width: 100%" columnClasses="column00, column01">
                                    <p:column>
                                        <h:panelGrid columns="5">
                                            <p:column>
                                                <p:commandButton value="Novo Lançamento" oncomplete="PF('i_dlg_novo').show()" action="#{lancamentoFinanceiroBean.abreModal}" update="i_dlg dlg_pedido" />
                                            </p:column>

                                            <p:column>
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.filtro.pesquisaPor}">
                                                    <p:ajax event="change" update="tbl i_pesquisa i_panel_search" listener="#{lancamentoFinanceiroBean.atualizaFiltro()}"/>

                                                    <f:selectItem itemLabel="Todos"           itemValue="todos"/>
                                                    <f:selectItem itemLabel="Últimos 60 Dias" itemValue="ultimos60dias"/>
                                                    <f:selectItem itemLabel="Emissão"         itemValue="emissao"/>
                                                    <f:selectItem itemLabel="Lançamento"      itemValue="lancamento"/>
                                                    <f:selectItem itemLabel="Documento (NF)"  itemValue="documentoNF"/>
                                                    <f:selectItem itemLabel="Fornecedor"      itemValue="fornecedor"/>
                                                    <f:selectItem itemLabel="CPF"             itemValue="cpf"/>
                                                    <f:selectItem itemLabel="CNPJ"            itemValue="cnpj"/>
                                                    <f:selectItem itemLabel="Valor (NF)"      itemValue="valorNF"/>
                                                </p:selectOneMenu>
                                            </p:column>

                                            <p:column>
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.filtro.indexTipoDocumentoPesquisa}" rendered="#{lancamentoFinanceiroBean.filtro.pesquisaPor eq 'documento'}">
                                                    <p:ajax event="change" update="i_panel_search"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.filtro.listaTipoDocumentoPesquisa}" />
                                                </p:selectOneMenu>
                                            </p:column>

                                            <p:column>
                                                <p:inputMask id="i_pesquisa" mask="#{lancamentoFinanceiroBean.filtro.mask}" value="#{lancamentoFinanceiroBean.filtro.descricao}" rendered="#{(lancamentoFinanceiroBean.filtro.pesquisaPor ne 'ultimos60dias' and lancamentoFinanceiroBean.filtro.pesquisaPor ne 'todos')}" onfocus="this.select()">
                                                    <p:ajax event="change" update="@this tbl i_panel_search" listener="#{lancamentoFinanceiroBean.loadListaLancamento()}"/>
                                                </p:inputMask>

                                                <p:watermark for="i_pesquisa" value="Digite sua Pesquisa"/>
                                                <p:focus for="i_pesquisa" />
                                                <p:defaultCommand target="btn_pesquisar" />
                                            </p:column>

                                            <p:column>
                                                <p:commandButton id="btn_pesquisar" icon="ui-icon-search" action="#{lancamentoFinanceiroBean.loadListaLancamento()}" update="@form"/>
                                            </p:column>
                                        </h:panelGrid>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Estou visualizando"/>
                                        <p:commandLink value="#{lancamentoFinanceiroBean.strVisualizando}" onclick="PF('i_dlg_visualizar').show()" style="font-weight: bold; margin-left: 5px" update="i_visualizar_lancamentos" disabled="#{controleAcessoBean.verificarPermissao('consulta_lancamentos_financeiros_outros', 4)}"/>
                                    </p:column>
                                </h:panelGrid>
                            </p:panel>


                            <h:panelGroup id="tbl" layout="block">
                                <p:dataTable var="lote" value="#{lancamentoFinanceiroBean.listaLancamento}" emptyMessage="Nenhum Lançamento Emitido!" rows="10" paginator="true">
                                    <p:column width="30" styleClass="text-center">
                                        <p:commandButton icon="ui-icon-pencil" title="Ver detalhes deste Lançamento" action="#{lancamentoFinanceiroBean.edit(lote)}" update="@form" oncomplete="PF('i_dlg_novo').show()" />
                                    </p:column>

                                    <p:column width="15">  
                                        <p:rowToggler />  
                                    </p:column> 

                                    <p:column headerText="Lançamento" width="90" styleClass="text-center">
                                        <h:outputLabel value="#{lote.lancamento}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Emissão" width="90" styleClass="text-center">
                                        <h:outputLabel  value="#{lote.emissao}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Documento" width="130" styleClass="text-center">
                                        <h:outputLabel  value="#{lote.documento}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Pessoa">
                                        <h:outputLabel  value="#{lote.pessoa.nome}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    
                                    </p:column>
                                    
                                    <p:column headerText="PAG/REC" style="text-align: center; width: 80px">
                                        <h:outputLabel value="#{lote.pagRec eq 'P' ? 'Pagamento' : 'Recebimento'}" style="#{lote.pagRec eq 'P' ? 'color:red' : 'color:green'}; font-size: 10px!important"/>
                                    </p:column>

                                    <p:column headerText="Valor (R$)"  width="80" styleClass="text-center">
                                        <h:outputLabel value="#{lote.valorString}" style="float: right"/>
                                    </p:column>

                                    <p:rowExpansion>
                                        <h:panelGrid columns="4" style="height: 40px" styleClass="sbb">
                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Nr Lote" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.id}"/>
                                                </h:panelGrid>
                                            </p:column>

                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Usuário" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.usuario.pessoa.nome}" />                                                
                                                </h:panelGrid>
                                            </p:column>

                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Filial" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.filial.filial.pessoa.nome}" />
                                                </h:panelGrid>
                                            </p:column>

                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Valor" styleClass="bold"/>
                                                    <h:outputLabel value="R$ #{lote.valorString}" />
                                                </h:panelGrid>
                                            </p:column>
                                        </h:panelGrid>
                                    </p:rowExpansion>
                                </p:dataTable>
                            </h:panelGroup>


                            <p:dialog modal="true" widgetVar="i_dlg_visualizar" header="Mudar Lista de Lançamento" width="300" height="300">
                                <h:panelGroup id="i_visualizar_lancamentos" layout="block">
                                    <h:panelGrid>
                                        <p:commandLink value="VER TODOS OS LANÇAMENTOS" action="#{lancamentoFinanceiroBean.alterarListaLancamento(usuario)}" update=":form_lf:i_panel_search :form_lf:tbl" oncomplete="PF('i_dlg_visualizar').hide()" style="font-weight: bold; margin-bottom: 10px"/>
                                    </h:panelGrid>

                                    <h:panelGrid>
                                        <p:dataList value="#{lancamentoFinanceiroBean.listaUsuarioLancamento}" var="usuario" type="definition"  style="height: 100px; border: 10px">
                                            <p:commandLink value="#{segurancaUtilitariosBean.sessaoUsuario.id == usuario.id ? 'MEUS LANÇAMENTOS' : usuario.pessoa.nome}" action="#{lancamentoFinanceiroBean.alterarListaLancamento(usuario)}" update=":form_lf:i_panel_search :form_lf:tbl" oncomplete="PF('i_dlg_visualizar').hide()"/><br /><br />
                                        </p:dataList>  
                                    </h:panelGrid>
                                </h:panelGroup>
                            </p:dialog>                            

                            <p:dialog id="i_dlg" widgetVar="i_dlg_novo" header="Lançamento" resizable="false" modal="true" width="1020" height="500" minHeight="600" visible="#{lancamentoFinanceiroBean.modalVisivel}" responsive="true" draggable="false" closeOnEscape="true" maximizable="true">
                                <p:ajax event="close" listener="#{lancamentoFinanceiroBean.fechaModal()}" update=":form_lf:"/>  
                                <h:panelGroup layout="block" id="i_validations">
                                    <h:outputText value="#{genericaMensagem.getHtmlMessage('error', 'CADATRAR CONTAS')}" escape="false" rendered="#{lancamentoFinanceiroBean.idContaOperacao eq 0}" />
                                </h:panelGroup>
                                <p:panel styleClass="fundoCinza">
                                    <h:panelGrid>
                                        <h:outputText value="Filial" />
                                        <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFilial}" style="width: 800px">
                                            <p:ajax event="change" update="@form" listener="#{lancamentoFinanceiroBean.atualizaComboOperacao()}"/>
                                            <f:selectItems value="#{lancamentoFinanceiroBean.listaFilial}"/>
                                        </p:selectOneMenu>                                        
                                    </h:panelGrid>                                        
                                </p:panel>
                                <h:panelGroup id="i_tipo" layout="block">
                                    <h:panelGrid columns="7" styleClass="margin-top-max">
                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Perfil da Conta" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.es}" style="width: 70px">
                                                    <p:ajax event="change" update="@form" listener="#{lancamentoFinanceiroBean.atualizaComboES()}" global="false"/>
                                                    <f:selectItem itemValue="E" itemLabel="Entrada"/>
                                                    <f:selectItem itemValue="S" itemLabel="Saida"/>
                                                </p:selectOneMenu>           
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid id="i_es_lanc">
                                                <h:outputText value="Perfil do Lançamento" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.esLancamento}" style="width: 70px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                    <f:selectItem itemValue="E" itemLabel="Entrada"/>
                                                    <f:selectItem itemValue="S" itemLabel="Saida"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Lançamento" />
                                                <p:inputMask value="#{lancamentoFinanceiroBean.lote.lancamento}" mask="99/99/9999" size="8" readonly="true">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Emissão" />
                                                <p:inputMask value="#{lancamentoFinanceiroBean.lote.emissao}" mask="99/99/9999" size="8" converter="#{isDateString}">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Condição"/>
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.condicao}" disabled="#{lancamentoFinanceiroBean.lote.id != -1 and not empty lancamentoFinanceiroBean.listaParcela}">
                                                    <p:ajax event="change" update="@form" global="false" listener="#{lancamentoFinanceiroBean.loadVencimento}"/>
                                                    <f:selectItem itemValue="vista" itemLabel="A Vista"/>
                                                    <f:selectItem itemValue="prazo" itemLabel="A Prazo"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </p:column>                                        

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Número Doc." />
                                                <p:inputText value="#{lancamentoFinanceiroBean.lote.documento}" style="width: 125px">
                                                    <p:ajax event="change" update="@this i_historico_padrao" global="false" listener="#{lancamentoFinanceiroBean.atualizaHistorico()}"/>
                                                </p:inputText>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Tipo" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFTipo}" style="width: 100px">
                                                    <p:ajax event="change" update="@this i_historico_padrao" global="false" listener="#{lancamentoFinanceiroBean.atualizaHistorico()}"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaFTipo}"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                        </h:column>                                        

                                    </h:panelGrid>
                                    <h:panelGrid columns="7">
                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Operação" styleClass="font-color-red bold" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idOperacao}">
                                                    <p:ajax event="change" update="@form" listener="#{lancamentoFinanceiroBean.atualizaComboOperacao()}" global="false"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaOperacao}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGroup layout="block" id="i_grupo">
                                                <h:panelGrid columns="3">
                                                    <h:column>
                                                        <h:panelGrid>
                                                            <h:outputText value="Centro Custo" styleClass="font-color-red bold"/>
                                                            <p:selectOneMenu value="#{lancamentoFinanceiroBean.idCentroCusto}"  disabled="#{lancamentoFinanceiroBean.idCentroCusto eq 0}">
                                                                <p:ajax event="change" update="@form" listener="#{lancamentoFinanceiroBean.atualizaComboCentroCusto()}"/>
                                                                <f:selectItems value="#{lancamentoFinanceiroBean.listaCentroCusto}"/>
                                                            </p:selectOneMenu>
                                                        </h:panelGrid>
                                                    </h:column>
                                                    <h:column>
                                                        <h:panelGrid>
                                                            <h:outputText value="Conta" styleClass="font-color-red bold"/>
                                                            <p:selectOneMenu value="#{lancamentoFinanceiroBean.idContaOperacao}" disabled="#{lancamentoFinanceiroBean.idContaOperacao eq 0}" filter="true" filterMatchMode="startsWith">
                                                                <p:ajax event="change" listener="#{lancamentoFinanceiroBean.atualizaHistorico()}" update="@form" />
                                                                <f:selectItems value="#{lancamentoFinanceiroBean.listaContaOperacao}"/>
                                                            </p:selectOneMenu>
                                                        </h:panelGrid>
                                                    </h:column>
                                                    <h:column>
                                                        <h:panelGroup id="i_chk_produtos" layout="block">
                                                            <p:selectBooleanCheckbox value="#{lancamentoFinanceiroBean.produtos}" rendered="#{lancamentoFinanceiroBean.plano.id != -1}" itemLabel="Produto">
                                                                <p:ajax event="change" update="@form" global="false"/>
                                                            </p:selectBooleanCheckbox>
                                                        </h:panelGroup>
                                                    </h:column>
                                                </h:panelGrid>
                                            </h:panelGroup>
                                        </p:column>

                                    </h:panelGrid>
                                </h:panelGroup>                                
                                <hr />
                                <h:panelGroup layout="block">
                                    <p:panel header="Credor/Devedor">
                                        <h:column rendered="#{lancamentoFinanceiroBean.pessoa.id != -1}">

                                        </h:column>
                                        <h:panelGrid columns="3" id="i_panel_cadastro" >
                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <h:column>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaFisica')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 1}"/>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaJuridica')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2}"/>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoa')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 4}" />
                                                    </h:column>
                                                    <p:selectOneMenu value="#{lancamentoFinanceiroBean.idTipoDocumento}">
                                                        <p:ajax event="change" listener="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_cadastro i_panel_pessoa" global="false"/>
                                                        <f:selectItems value="#{lancamentoFinanceiroBean.listaTipoDocumento}" />
                                                    </p:selectOneMenu>
                                                </h:panelGrid>
                                            </p:column>

                                            <p:column>
                                                <p:inputMask id="i_documento" value="#{lancamentoFinanceiroBean.descricao}" size="20" mask="#{lancamentoFinanceiroBean.mascara}" styleClass="text-center" disabled="#{lancamentoFinanceiroBean.idTipoDocumento == 4}" >
                                                    <p:ajax event="change" listener="#{lancamentoFinanceiroBean.pesquisarPessoa()}" update="i_panel_pessoa i_panel_cadastro i_historico_padrao" />
                                                </p:inputMask>

                                                <p:watermark value="Documento" for="i_documento" />
                                            </p:column>

                                            <p:column>
                                                <p:commandLink value="Não encontrou na pesquisa? Cadastre uma nova pessoa aqui" style="margin-left: 20px" rendered="#{lancamentoFinanceiroBean.pessoa.id == -1}">
                                                    <p:ajax event="click" listener="#{lancamentoFinanceiroBean.cadastrarPessoa('')}" update="i_panel_pessoa i_msg " />
                                                </p:commandLink>
                                            </p:column>
                                        </h:panelGrid>
                                        <h:panelGrid id="i_panel_pessoa" columns="2">
                                            <h:column rendered="#{lancamentoFinanceiroBean.pessoa.id != -1}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Nome:" style="font-weight: bold"/>
                                                    <h:outputText value="#{lancamentoFinanceiroBean.pessoa.nome}"/>

                                                    <p:commandLink value="Limpar tudo e começar de Novo" action="#{lancamentoFinanceiroBean.limpar()}" update="form_lf" style="margin-left: 150px" />
                                                </h:panelGrid>
                                            </h:column>

                                            <h:column rendered="#{lancamentoFinanceiroBean.opcaoCadastro != '' and lancamentoFinanceiroBean.opcaoCadastro == 'juridica'}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Cadastro de Empresa" style="font-weight: bold"/>
                                                    <p:commandLink ajax="false" value="Ir para cadastro completo" action="#{chamadaPaginaBean.pessoaJuridica()}" style="margin-left: 20px"/>
                                                    <p:commandLink ajax="true" value="Quero cadastrar uma PESSOA FÍSICA" action="#{lancamentoFinanceiroBean.cadastrarPessoa('fisica')}" update="i_panel_pessoa" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2}" style="margin-left: 50px"/>
                                                </h:panelGrid><br />
                                                <h:panelGrid columns="4" id="i_nome_empresa_2">
                                                    <p:inputText id="i_nome_empresa" value="#{lancamentoFinanceiroBean.pessoa.nome}" style="margin-right: 15px;" size="50" converter="#{toUpperCase}">
                                                        <p:ajax event="change" update="@this i_nome_empresa_2" listener="#{pessoaSugestaoBean.sugerirPessoaJuridica(lancamentoFinanceiroBean.pessoa)}"/>
                                                    </p:inputText>
                                                    <p:watermark value="Nome da Empresa" for="i_nome_empresa"/>
                                                    <p:commandButton value="Salvar" action="#{lancamentoFinanceiroBean.salvarPessoa}" update="i_panel_pessoa i_panel_cadastro i_msg" disabled="#{empty lancamentoFinanceiroBean.pessoa.nome}"/>
                                                    <p:commandButton action="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_pessoa i_panel_cadastro" icon="ui-icon-close" />  
                                                </h:panelGrid>
                                            </h:column>

                                            <h:column rendered="#{lancamentoFinanceiroBean.opcaoCadastro != '' and lancamentoFinanceiroBean.opcaoCadastro == 'fisica'}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Cadastro de Pessoa Física" style="font-weight: bold"/>
                                                    <p:commandLink ajax="false" value="Ir para cadastro completo" action="#{chamadaPaginaBean.pessoaFisica()}" style="margin-left: 20px"/>
                                                    <p:commandLink ajax="true" value="Quero cadastrar uma PESSOA JURÍDICA" action="#{lancamentoFinanceiroBean.cadastrarPessoa('juridica')}" update="i_panel_pessoa" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2}" style="margin-left: 50px"/>
                                                </h:panelGrid><br />
                                                <h:panelGrid columns="4">
                                                    <p:inputText id="i_nome_fisica" value="#{lancamentoFinanceiroBean.pessoa.nome}" style="margin-right: 15px;" size="50" converter="#{toUpperCase}">
                                                        <p:ajax event="change" update="@this" listener="#{pessoaSugestaoBean.sugerirPessoaFisica(lancamentoFinanceiroBean.pessoa)}"/>
                                                    </p:inputText>
                                                    <p:watermark value="Nome da Pessoa" for="i_nome_fisica"/>
                                                    <p:commandButton value="Salvar" action="#{lancamentoFinanceiroBean.salvarPessoa}" update="i_panel_pessoa i_panel_cadastro i_msg" />
                                                    <p:commandButton action="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_pessoa i_panel_cadastro" icon="ui-icon-close" />  
                                                </h:panelGrid>
                                            </h:column>
                                        </h:panelGrid>
                                    </p:panel>
                                </h:panelGroup>

                                <p:messages id="i_msg" showDetail="true" closable="true"/>  
                                <br />
                                <h:panelGrid columns="2">
                                    <h:outputText value="VALOR TOTAL DA NOTA: " style="font-weight: bold; color: red; font-size: 11pt!important"/>
                                    <h:column>
                                        <h:column rendered="#{lancamentoFinanceiroBean.plano.id == -1}">
                                            <p:inputText value="#{lancamentoFinanceiroBean.total}" size="8" style="text-align: right; font-size: 11pt!important" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>
                                        </h:column>
                                        <h:column rendered="#{lancamentoFinanceiroBean.plano.id != -1}">
                                            <p:inputText value="#{lancamentoFinanceiroBean.total}" size="8" style="text-align: right; font-size: 11pt!important" converter="#{toCurrency}" rendered="#{!lancamentoFinanceiroBean.produtos}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>                                                        
                                            <p:commandButton value="R$ #{lancamentoFinanceiroBean.total}" action="#{lancamentoFinanceiroBean.openModalPedido()}" oncomplete="PF('dlg_pedido').show();" style="font-weight: bold" update=":form_lf:dlg_pedido" rendered="#{lancamentoFinanceiroBean.produtos}"/>
                                        </h:column>
                                    </h:column>
                                </h:panelGrid>

                                <p:panel id="panel_nova_parcela" styleClass="fundoCinza margin-top-max">
                                    <h:panelGrid>
                                        <p:outputLabel value="NOVA PARCELA" style="font-size: 11pt!important; text-decoration: underline; font-weight: bold" rendered="#{lancamentoFinanceiroBean.acaoParcela eq 'nova'}"/>
                                        <p:outputLabel value="EDITAR PARCELA" style="font-size: 11pt!important; text-decoration: underline; font-weight: bold" rendered="#{lancamentoFinanceiroBean.acaoParcela eq 'editar'}" />
                                    </h:panelGrid>

                                    <h:panelGrid id="i_para_conta" columns="3">
                                        <h:outputLabel value="Lançamento para Conta " />
                                        <h:outputLabel value="#{lancamentoFinanceiroBean.strConta}" style="font-weight: bold"/>

                                        <p:selectBooleanCheckbox value="#{lancamentoFinanceiroBean.chkImposto}" itemLabel="IMPOSTO">
                                            <p:ajax event="change" update="@form" listener="#{lancamentoFinanceiroBean.openDialogImposto()}"  />
                                        </p:selectBooleanCheckbox>
                                    </h:panelGrid>

                                    <h:panelGrid id="i_valor" columns="9">
                                        <p:column>
                                            <h:panelGrid id="i_vencimento">
                                                <h:outputText value="Vencimento" style="font-weight: bold"/>
                                                <p:inputMask value="#{lancamentoFinanceiroBean.vencimento}" mask="99/99/9999" size="8" converter="#{isDateString}" styleClass="text-center" readonly="#{lancamentoFinanceiroBean.condicao eq 'vista' and lancamentoFinanceiroBean.listaParcela.size() eq 1 and !lancamentoFinanceiroBean.chkImposto and lancamentoFinanceiroBean.acaoParcela eq 'nova'}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </p:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputLabel value="Número Doc." />
                                                <p:inputText value="#{lancamentoFinanceiroBean.documentoMovimento}" size="10">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Tipo Documento" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFTipoMovimento}" style="width: 130px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaFTipoMovimento}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Valor" style="font-weight: bold"/>
                                                <p:inputText value="#{lancamentoFinanceiroBean.valor}" size="8" style="text-align: right" converter="#{toCurrency}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value=" Acréscimo"/>
                                                <p:commandButton value="#{lancamentoFinanceiroBean.acrescimo}" action="#{lancamentoFinanceiroBean.openModalAcrescimo()}" update=":form_lf:i_panel_acrescimo" oncomplete="PF('i_dlg_acrescimo').show()"/>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Desconto" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.desconto}" size="7" style="text-align: right" converter="#{toCurrency}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:column>
                                                    <br />
                                                </h:column>
                                                <p:commandButton value="ADICIONAR NOVA PARCELA" title="Adicionar" icon="ui-icon-plus" action="#{lancamentoFinanceiroBean.adicionarParcela()}" update="@form" rendered="#{lancamentoFinanceiroBean.acaoParcela eq 'nova'}"/>
                                                <p:commandButton value="ATUALIZAR" title="Atualizar" icon="ui-icon-refresh" action="#{lancamentoFinanceiroBean.atualizarParcela()}" update="@form" rendered="#{lancamentoFinanceiroBean.acaoParcela eq 'editar'}"/>
                                            </h:panelGrid>
                                        </p:column>
                                        
                                        <p:column>
                                            <h:panelGrid>
                                                <h:column>
                                                    <br />
                                                </h:column>
                                                <p:commandButton value="CANCELAR" icon="ui-icon-cancel" title="CANCELAR" action="#{lancamentoFinanceiroBean.novaParcela()}" update="@form" rendered="#{lancamentoFinanceiroBean.acaoParcela eq 'editar'}"/>
                                            </h:panelGrid>
                                        </p:column>
                                    </h:panelGrid>

                                </p:panel>

                                <br />

                                <h:panelGrid columns="1" style="width: 100%">
                                    <p:outputLabel value="Histórico Padrão" style="font-weight: bold"/>
                                    <p:inputTextarea id="i_historico_padrao" style="width: 100%; opacity: .8; font-style: italic; font-weight: bold" rows="2" value="#{lancamentoFinanceiroBean.lote.historicoContabilPadrao}" placeholder="Histórico Padrão Gerado pelo Sistema" disabled="true" />

                                    <p:outputLabel value="Histórico Personalizado" style="font-weight: bold"/>
                                    <p:inputTextarea id="i_historico" style="width: 100%;" rows="2" maxlength="2000" value="#{lancamentoFinanceiroBean.lote.historicoContabil}" placeholder="Histórico Personalizado" autoResize="true" />
                                </h:panelGrid>

                                <p:dataTable var="parcela" id="tbl_p" value="#{lancamentoFinanceiroBean.listaParcela}" selection="#{lancamentoFinanceiroBean.listaParcelaSelecionada}" rowKey="#{parcela.parcela}" rowIndexVar="index" emptyMessage="Adicionar Parcela!" scrollable="true" scrollHeight="110" editable="#{lancamentoFinanceiroBean.lote.id == -1}" editMode="cell" styleClass="margin-top-max">
                                    <p:column selectionMode="multiple" width="15" styleClass="text-center" />
                                    <p:column width="15">  
                                        <p:rowToggler />  
                                    </p:column>

                                    <p:column width="15">
                                        <p:commandButton action="#{lancamentoFinanceiroBean.openExcluirParcela(parcela, index)}" oncomplete="PF('i_dlg_ex_movimento').show()" title="Excluir Movimento" icon="ui-icon-close" style="width: 20px; height: 20px" disabled="#{not empty parcela.dataQuitacao}"/>
                                    </p:column>

                                    <p:column headerText="Vencto" styleClass="text-center">
                                        <h:outputLabel value="#{parcela.vencimento}" />
                                    </p:column>

                                    <p:column headerText="Referência" styleClass="text-center">
                                        <p:inputMask mask="99/9999" value="#{parcela.referencia}" placeholder="__/____" converter="#{isDateReference}" size="8" styleClass="text-center" readonly="#{not empty parcela.dataQuitacao}">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputMask>
                                    </p:column>

                                    <p:column headerText="Valor" styleClass="text-right">
                                        <h:outputLabel value="R$ #{parcela.valor}" style="font-weight: bold"/>
                                    </p:column>

                                    <p:column headerText="Acréscimo">
                                        <h:outputText value="R$ "/>
                                        <p:commandLink value="#{parcela.acrescimo}" style="float: right; font-size: 10pt!important; font-weight: bold" oncomplete="PF('i_dlg_acrescimo').show()" rendered="#{lancamentoFinanceiroBean.lote.id == -1}">
                                            <p:ajax event="click" update=":form_lf:i_panel_acrescimo" listener="#{lancamentoFinanceiroBean.alterarAcrescimo(index)}" />
                                        </p:commandLink>
                                        <h:outputLabel value="#{parcela.acrescimo}" style="float: right;" rendered="#{lancamentoFinanceiroBean.lote.id != -1}"/>
                                    </p:column>

                                    <p:column headerText="Desconto">
                                        <p:cellEditor>  
                                            <f:facet name="output">
                                                <h:outputText value="R$ "/>
                                                <h:outputText value="#{parcela.desconto}" style="float: right"/>
                                            </f:facet>  
                                            <f:facet name="input">
                                                <p:inputText value="#{parcela.desconto}" style="width:96%" label="Desconto">
                                                    <p:ajax event="change" update="tbl_p" listener="#{lancamentoFinanceiroBean.alterarDesconto(index)}" global="false"/>
                                                </p:inputText>
                                            </f:facet>  
                                        </p:cellEditor>  
                                    </p:column>


                                    <p:column headerText="Vl Pagto">
                                        <h:outputText value="R$ "/>
                                        <h:outputText value="#{parcela.valorQuitado}" style="float: right"/>
                                    </p:column>

                                    <p:column headerText="Data Pagto" styleClass="text-center">
                                        <h:outputText value="#{parcela.dataQuitacao}"/>
                                    </p:column>

                                    <p:column style="text-align: center; width: 45px" headerText="Recibo">
                                        <h:commandLink target="#{lancamentoFinanceiroBean.targetImprimeRecibo(parcela.movimento)}" action="#{lancamentoFinanceiroBean.recibo(parcela.movimento)}" title="Imprimir este Recibo" rendered="#{parcela.movimento.baixa ne null}">
                                            <p:commandButton icon="ui-icon-print" title="Imprimir este Recibo"/>
                                        </h:commandLink>
                                    </p:column>

                                    <p:column style="text-align: center; width: 45px" headerText="Editar">
                                        <p:commandButton action="#{lancamentoFinanceiroBean.editarParcela(parcela, index)}" icon="ui-icon-edit" title="Editar esta Parcela" rendered="#{parcela.movimento.baixa eq null}" update="form_lf:panel_nova_parcela" />
                                    </p:column>

                                    <p:rowExpansion>
                                        <h:panelGrid columns="4" style="height: 40px">
                                            <p:column>
                                                <h:outputText value="Conta" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.plano5.conta}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Operador (Criação)" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.usuarioNome}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Tipo de Documento" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.tipoDocumento.descricao}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Documento" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.documento}" />
                                            </p:column>    
                                        </h:panelGrid>

                                        <h:panelGrid columns="4" style="height: 40px">
                                            <p:column>
                                                <h:outputText value="Lote Baixa" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.loteBaixa}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Operador (Baixa)" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.baixa.usuario.pessoa.nome}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Caixa" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.caixa}" />
                                            </p:column>                                        

                                            <p:column>

                                            </p:column>                                        
                                        </h:panelGrid>
                                    </p:rowExpansion>
                                </p:dataTable>
                                <br />
                                <f:facet name="footer">
                                    <h:panelGrid columns="8" id="i_actions">
                                        <h:column rendered="#{lancamentoFinanceiroBean.idContaOperacao ne 0}">
                                            <p:commandButton value="Salvar" onclick="PF('i_dlg_salvar').show()" title="Salvar este Lançamento" disabled="#{controleAcessoBean.verificarPermissao('lancamento_financeiro', 1)}"/>
                                        </h:column>
                                        <p:commandButton value="Novo" action="#{lancamentoFinanceiroBean.limpar()}" update="@form" title="Limpar tudo e começar de Novo" />
                                        <p:commandButton ajax="false" value="Baixar" action="#{lancamentoFinanceiroBean.telaBaixa()}" update="tbl_p" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" title="Baixar este Lançamento" />
                                        <p:commandButton value="Estornar" onclick="PF('i_dlg_estornar').show()" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" disabled="#{controleAcessoBean.verificarPermissao('estorno_lancamento_financeiro', 2)}" title="ESTORNO LANÇAMENTO FINANÇEIRO (EXCLUSÃO)"/>
                                        <p:commandButton value="Excluir este Lançamento" onclick="PF('i_dlg_ex_lancamento').show()" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" title="Excluir este Lançamento" disabled="#{controleAcessoBean.verificarPermissao('lancamento_financeiro', 2)}"/>
                                        <p:commandButton value="Fechar esta Janela" action="#{lancamentoFinanceiroBean.fechaModal()}" onclick="PF('i_dlg_novo').hide();" update="@form"/>
                                    </h:panelGrid>

                                </f:facet>
                            </p:dialog>

                            <p:dialog id="i_dlg_conta" widgetVar="dlg_conta" header="CONTA OBRIGAÇÃO" modal="true" resizable="false" width="600" height="70" visible="#{lancamentoFinanceiroBean.adicionarImposto}" closable="false" draggable="false">
                                <h:panelGrid columns="2" cellspacing="5">
                                    <h:outputText value="CONTA: " styleClass="bold"/>
                                    <p:selectOneMenu value="#{lancamentoFinanceiroBean.idPlano5}">
                                        <p:ajax event="change" update="@this" />
                                        <f:selectItems value="#{lancamentoFinanceiroBean.listaPlano5}"/>
                                    </p:selectOneMenu>                                                
                                </h:panelGrid>

                                <f:facet name="footer">
                                    <h:panelGrid>
                                        <p:commandButton value="OK" update="@form" onclick="PF('dlg_conta').hide()" action="#{lancamentoFinanceiroBean.closeDialogImposto()}"/>                                            
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>                            

                            <p:dialog id="dlg_pedido" widgetVar="dlg_pedido" width="800" resizable="false" modal="true" visible="#{lancamentoFinanceiroBean.modalPedido}" header="Itens da nota">
                                <p:ajax event="close" listener="#{lancamentoFinanceiroBean.closeModalPedido()}" update="@form"/>
                                <h:panelGrid id="i_grid_pedido">
                                    <!-- TELA CADASTRO -->
                                    <p:messages autoUpdate="true" showSummary="true" showDetail="true" id="i_message_pedido"/>
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Pesquisar" icon="ui-icon-search" title="Pesquisar Produto" action="#{chamadaPaginaBean.pesquisaProduto()}" actionListener="#{genericaSessao.putString('type', 'all')}"/>
                                        <p:outputLabel value="#{lancamentoFinanceiroBean.pedido.produto.descricao} #{lancamentoFinanceiroBean.pedido.produto.marca} #{lancamentoFinanceiroBean.pedido.produto.medida} (#{lancamentoFinanceiroBean.pedido.produto.produtoUnidade.descricao})" />
                                    </h:panelGrid>

                                    <h:panelGrid columns="4">
                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Quantidade" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.quantidadePedidoString}" size="5" style="margin-right: 15px" converter="#{thisNumber}">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Valor Unitário" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.valorUnitarioPedido}" size="8" style="margin-right: 15px" converter="#{toCurrency4}" styleClass="text-right">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Desconto Unitário" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.descontoUnitarioPedido}" size="12" converter="#{toCurrency}" styleClass="text-right">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>    

                                        <p:column>    
                                            <h:panelGrid>
                                                <h:column>
                                                    <br />                                                    
                                                </h:column>
                                                <p:commandButton value="Adicionar" icon="ui-icon-plus" action="#{lancamentoFinanceiroBean.addItemPedido()}" update="i_grid_pedido i_message_pedido"/>
                                            </h:panelGrid>
                                        </p:column>    
                                    </h:panelGrid>

                                    <!-- // TELA CADASTRO -->

                                    <!-- TELA LISTA PEDIDOS -->

                                    <p:dataTable value="#{lancamentoFinanceiroBean.listaPedidos}" style="width: 770px" var="pedido" scrollable="true" scrollHeight="150" emptyMessage="Nenhum registro encontrado!" rowIndexVar="index" >
                                        <!-- <p:column styleClass="text-center" style="width: 10px">
                                            <p:commandButton icon="ui-icon-link" action="# {lancamentoFinanceiroBean.editarItemPedido(index)}" update=":form_lf:i_grid_pedido" title="Editar registro"/>
                                        </p:column> -->
                                        <p:column headerText="Produto" style="width: 100px">
                                            #{pedido.produto.descricao}
                                        </p:column>
                                        <p:column headerText="Qnt" styleClass="text-center" style="width: 20px">
                                            #{pedido.quantidade}
                                        </p:column>
                                        <p:column headerText="Valor Unitário" style="text-align: right; width: 80px">
                                            #{pedido.valorUnitarioString}
                                        </p:column>
                                        <p:column headerText="Desconto" style="text-align: right; width: 80px">
                                            #{pedido.descontoUnitarioString}
                                        </p:column>                                
                                        <p:column headerText="Valor Total" style="text-align: right; width: 80px">
                                            <h:outputText value="#{lancamentoFinanceiroBean.valorTotalGrid(pedido)}" />
                                        </p:column>                                
                                        <p:column styleClass="text-center" style="width: 15px">
                                            <p:commandButton icon="ui-icon-trash" action="#{lancamentoFinanceiroBean.removeItemPedido(index)}" update=":form_lf:dlg_pedido" title="Remover registro"/>
                                        </p:column>
                                        <f:facet name="footer">                                    
                                            Valor Total: #{lancamentoFinanceiroBean.valorTotal}
                                        </f:facet>
                                    </p:dataTable>

                                    <!-- TELA LISTA PEDIDOS -->

                                    <!-- AÇÕES -->
                                    <f:facet name="footer">
                                        <h:panelGrid columns="4">
                                            <h:column rendered="#{lancamentoFinanceiroBean.lote.id == -1}">
                                                <p:commandButton value="Novo" action="#{lancamentoFinanceiroBean.novoPedido()}" update="dlg_pedido" />
                                            </h:column>

                                            <p:commandButton value="Concluir" action="#{lancamentoFinanceiroBean.closeModalPedido()}" onclick="PF('dlg_pedido').hide();"/>
                                        </h:panelGrid>
                                    </f:facet>

                                    <!-- // AÇÕES -->
                                </h:panelGrid>

                            </p:dialog>                             
                            
                            <p:dialog widgetVar="i_dlg_salvar" header="Deseja realmente SALVAR este lançamento?" resizable="false" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_salvar').hide()" action="#{lancamentoFinanceiroBean.save}" update="form_lf" title="Salvar este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_salvar').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_estornar" header="Deseja realmente ESTORNAR este lançamento?" resizable="false" modal="true">
                                <h:panelGrid>
                                    <p:outputLabel value="Motivo" />
                                    <p:inputTextarea value="#{lancamentoFinanceiroBean.motivoEstorno}" cols="70" rows="2" placeholder="Digite um motivo para o Estorno"/>
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_estornar').hide()" action="#{lancamentoFinanceiroBean.reverse()}" update="tbl_p i_msg" title="Estornar este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_estornar').hide()" icon="ui-icon-close"/>                                          
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_ex_lancamento" header="Deseja EXCLUIR DEFINITIVAMENTE este lançamento?" resizable="false" modal="true">
                                <h:outputLabel value="(Atenção) Após a exclusão este lançamento não poderá ser retornado!" style="font-size: 10pt!important; color: red"/>

                                <h:panelGrid style="width: 100%">
                                    <p:outputLabel value="Digite um motivo para exclusão" style="font-size: 10pt!important; font-weight: bold"/>
                                    <p:inputTextarea value="#{lancamentoFinanceiroBean.motivoInativacao}" style="width: 100%"/>
                                </h:panelGrid>

                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_ex_lancamento').hide()" action="#{lancamentoFinanceiroBean.delete()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_ex_lancamento').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_ex_movimento" header="Excluir esta linha do Lançamento" resizable="false" modal="true">
                                <h:outputLabel value="Deseja EXCLUIR este Movimento?" />
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_ex_movimento').hide()" action="#{lancamentoFinanceiroBean.excluirParcela()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_ex_movimento').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_acrescimo" header="Lançar Acréscimo" resizable="false" modal="true" draggable="false">
                                <h:panelGrid id="i_panel_acrescimo" columns="3">
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Multa" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.multa}" size="8" styleClass="text-right">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>                                            
                                        </h:panelGrid>
                                    </p:column>
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Juros" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.juros}" size="8" styleClass="text-right" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>
                                        </h:panelGrid>
                                    </p:column>
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Correção" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.correcao}" size="8" styleClass="text-right" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>
                                        </h:panelGrid>
                                    </p:column>
                                </h:panelGrid>

                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Adicionar" onclick="PF('i_dlg_acrescimo').hide()" action="#{lancamentoFinanceiroBean.adicionarAcrescimo()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Cancelar" onclick="PF('i_dlg_acrescimo').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <!-- 
                            ########################################################
                            ########################################################
                            
                            DETALHES DA PESSOA
                            
                            ########################################################
                            ########################################################
                            -->                            
                            <p:dialog widgetVar="dlg_pessoa_fisica_card" modal="true" resizable="false" height="400" width="400" header="Detalhes">
                                <p:ajax event="close" listener="#{pessoaCardBean.close}"/>  
                                <p:panel id="i_pessoa_fisica_card">
                                    <ui:include src="templates/templatePessoaFisicaCard.xhtml" />
                                </p:panel>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_pessoa_juridica_card" modal="true" resizable="false" height="400" width="400" header="Detalhes">
                                <p:ajax event="close" listener="#{pessoaCardBean.close}"/>  
                                <p:panel id="i_pessoa_juridica_card">
                                    <ui:include src="templates/templatePessoaJuridicaCard.xhtml" />
                                </p:panel>
                            </p:dialog>

                            <p:spotlight target="panel_nova_parcela" widgetVar="spot" />
                        </h:form>
                        <!-- 
                        ########################################################
                        ########################################################
                        
                        SUGESTÃO DE PESSOA
                        
                        ########################################################
                        ########################################################
                        -->
                        <h:form id="form_pessoa_sugestao">
                            <!-- 
                            ####################################################
                            ####################################################
                            
                            PESSOA FÍSICA
                            
                            ####################################################
                            ####################################################
                            -->
                            <p:dialog widgetVar="dlg_sugestoes_fisica" modal="true" resizable="false" height="250" width="1024" header="Existem cadastros com mesmo nome">
                                <h:panelGroup id="i_sugestoes_fisica" layout="block">
                                    <p:dataTable value="#{pessoaSugestaoBean.listFisicaSugestao}" var="fisicaSugestao" emptyMessage="Nenhum registro encontrado" scrollHeight="200" scrollable="true" paginator="true" rows="100">
                                        <p:ajax event="rowToggle" listener="#{pessoaSugestaoBean.listenerSocios(fisicaSugestao.pessoa.id)}" />
                                        <p:column style="width:5%">  
                                            <p:rowToggler />  
                                        </p:column>
                                        <p:column headerText="Nome">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaFisica(fisicaSugestao)}" update=":form_lf:" value="#{fisicaSugestao.pessoa.nome}" title="#{fisicaSugestao.pessoa.id}" oncomplete="PF('dlg_sugestoes_fisica').hide()"/>
                                        </p:column>
                                        <p:column headerText="RG" width="80"  styleClass="text-center">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaFisica(fisicaSugestao)}"  update=":form_lf:" value="#{fisicaSugestao.rg}" oncomplete="PF('dlg_sugestoes_fisica').hide()"/>
                                        </p:column>

                                        <p:column headerText="CPF" width="100"  styleClass="text-center">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaFisica(fisicaSugestao)}"  update=":form_lf:" value="#{fisicaSugestao.pessoa.documento}" oncomplete="PF('dlg_sugestoes_fisica').hide()"/>
                                        </p:column>                            

                                        <p:column headerText="E-mail">
                                            <h:outputText value="#{fisicaSugestao.pessoa.email1}"/>
                                        </p:column>

                                        <p:column headerText="Telefone" width="100" styleClass="text-center">
                                            <h:outputText value="#{fisicaSugestao.pessoa.telefone1}"/>
                                        </p:column>

                                        <p:rowExpansion>
                                            <h:panelGrid columns="5" style="height: 40px" styleClass="sbb">
                                                <p:column>
                                                    <h:outputText value="CÓDIGO" style="font-weight: bold"/><br />
                                                    <h:outputText value="#{fisicaSugestao.pessoa.id}"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="Dt Nascimento" style="font-weight: bold"/><br />
                                                    <h:outputText value="#{fisicaSugestao.nascimento}"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="Local de trabalho" style="font-weight: bold"/><br />
                                                    <h:outputText value="#{pessoaSugestaoBean.pessoaEmpresaString(fisicaSugestao)}"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="Pessoa cadastrada em oposição!" style="font-weight: bold; color: red;" rendered="#{pessoaSugestaoBean.existePessoaOposicaoPorDocumento(fisicaSugestao.pessoa.documento)}"/>
                                                </p:column>
                                                <p:column>
                                                    <p:commandButton icon="ui-icon-contact" update=":form_lf:i_pessoa_fisica_card" onclick="PF('dlg_pessoa_fisica_card').show()" action="#{pessoaCardBean.cardFisica(fisicaSugestao.pessoa.id)}" title="Ver detalhes" />
                                                </p:column>
                                            </h:panelGrid>
                                            <h:panelGrid style="height: 40px" styleClass="sbb">
                                                <h:outputLabel value="Endereço: #{fisicaSugestao.pessoa.pessoaEndereco.enderecoCompletoString} " styleClass="bold font-color-red"/>
                                            </h:panelGrid>
                                            <p:panel header="Titular / Dependente(s) - Matrícula: #{fisicaSugestao.pessoa.socios.matriculaSocios.nrMatricula} - Categoria: #{fisicaSugestao.pessoa.socios.matriculaSocios.categoria.categoria}" rendered="#{not empty pessoaSugestaoBean.listaSocios}">
                                                <p:dataTable value="#{pessoaSugestaoBean.listaSocios}" var="dependentes">
                                                    <p:column headerText="Nome">                                                
                                                        <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaFisica(dependentes.servicoPessoa.pessoa.fisica)}" value="#{dependentes.servicoPessoa.pessoa.nome}" title="Editar pessoa" styleClass="#{dependentes.parentesco.parentesco eq 'TITULAR' ? 'font-color-red bold' : ''}" oncomplete="PF('dlg_sugestoes_fisica').hide()"/>
                                                    </p:column>
                                                    <p:column headerText="Parentesco" styleClass="#{dependentes.parentesco.parentesco eq 'TITULAR' ? 'font-color-red bold' : ''}">
                                                        #{dependentes.parentesco.parentesco}
                                                    </p:column>
                                                    <p:column width="30">
                                                        <p:commandButton icon="ui-icon-contact" update=":form_lf:i_pessoa_fisica_card" onclick="PF('dlg_pessoa_fisica_card').show()" action="#{pessoaCardBean.cardFisica(dependentes.servicoPessoa.pessoa.id)}" title="Ver detalhes" />
                                                    </p:column>
                                                </p:dataTable>                                            
                                            </p:panel>
                                            <h:column>
                                                <p:panel rendered="#{empty pessoaSugestaoBean.listaSocios}">
                                                    <p:outputLabel value="NÃO SÓCIO" styleClass="bold font-color-red" style="font-size: 16pt!important"/>
                                                </p:panel>
                                            </h:column>                                            
                                        </p:rowExpansion>
                                    </p:dataTable>                                    
                                </h:panelGroup>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Fechar" title="Fechar" onclick="PF('dlg_sugestoes_fisica').hide();"  />                                        
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>  
                            <!-- 
                            ####################################################
                            ####################################################

                            PESSOA JURÍDICA

                            ####################################################
                            ####################################################
                            -->                        
                            <p:dialog widgetVar="dlg_sugestoes_juridica" modal="true" resizable="false" height="250" width="1024" header="Existem cadastros com mesmo nome">
                                <h:panelGroup id="i_sugestoes_juridica" layout="block">
                                    <p:dataTable value="#{pessoaSugestaoBean.listJuridicaSugestao}" var="juridicaSugestao" emptyMessage="Nenhum registro encontrado" scrollHeight="200" scrollable="true" paginator="true" rows="100">
                                        <p:column headerText="Razão Social">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaJuridica(juridicaSugestao)}" update=":form_lf:" value="#{juridicaSugestao.pessoa.nome}" title="#{juridicaSugestao.pessoa.id}" oncomplete="PF('dlg_sugestoes_juridica').hide()"/>
                                        </p:column>
                                        <p:column headerText="Fantasia">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaJuridica(juridicaSugestao)}" update=":form_lf:" value="#{juridicaSugestao.pessoa.nome}" title="#{juridicaSugestao.pessoa.id}" oncomplete="PF('dlg_sugestoes_juridica').hide()"/>
                                        </p:column>
                                        <p:column headerText="DOCUMENTO" width="100"  styleClass="text-center">
                                            <p:commandLink action="#{pessoaSugestaoBean.selectedPessoaJuridica(juridicaSugestao)}" update=":form_lf:" value="#{juridicaSugestao.pessoa.documento}" oncomplete="PF('dlg_sugestoes_juridica').hide()"/>
                                        </p:column>
                                        <p:column headerText="E-mail">
                                            <h:outputText value="#{juridicaSugestao.pessoa.email1}"/>
                                        </p:column>
                                        <p:column headerText="Telefone" width="100" styleClass="text-center">
                                            <h:outputText value="#{juridicaSugestao.pessoa.telefone1}"/>
                                        </p:column>
                                        <p:column width="30">
                                            <p:commandButton icon="ui-icon-contact" update=":form_lf:i_pessoa_juridica_card" onclick="PF('dlg_pessoa_juridica_card').show()" action="#{pessoaCardBean.cardJuridica(juridicaSugestao.pessoa.id)}" title="Ver detalhes" />
                                        </p:column>
                                    </p:dataTable>                                    
                                </h:panelGroup>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Fechar" title="Fechar" onclick="PF('dlg_sugestoes_juridica').hide();"  />                                        
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>


                        </h:form>
                    </p:panel>
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>