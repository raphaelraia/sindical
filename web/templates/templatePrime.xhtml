<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <script type="text/javascript">
            window.history.forward(1);
        </script>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link href="#{facesContext.externalContext.requestContextPath}/resources/css/default.css" rel="stylesheet" type="text/css"/>
        <link href="#{facesContext.externalContext.requestContextPath}/resources/css/reset.css" rel="stylesheet" type="text/css"/>
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-datalist-item {float: left!important;}
            * {font-family: 'lucida grande', verdana, tahoma, arial, sans-serif; font-size: 9pt!important}
        </style>
        <c:if test="#{controleUsuarioBean.development}">
            <style type="text/css">
                body, .ui-panel-content {background: #f7f7f7!important}
            </style>
        </c:if>
    </h:head>
    <h:body onload="#{controleAcessoBean.validacao}"></h:body>
    <h:body onload="#{configuracaoBean.loadResolucao()}"></h:body>
    <div style="width: 100%; height: 40px; background: #ECF3FE;"></div>
    <f:view>
        <h:outputScript name="tradutor_primefaces.js" library="js" /> 
        <h:form id="form_log">
            <p:messages id="i_messages" autoUpdate="false" showDetail="true" showSummary="true" closable="true" rendered="#{segurancaUtilitariosBean.sessaoUsuario.id == 1 and controleUsuarioBean.habilitaLog}"/>
        </h:form>
        <h:form id="form_logo_upload" enctype="multipart/form-data" acceptcharset="UTF-8" style="">
            <p:dialog id="i_dlg_logo" widgetVar="dlg_logo" modal="true"  header="Anexar logo" closable="true">
                <p:fileUpload label="Procurar"
                              cancelLabel="Cancelar"
                              uploadLabel="Anexar"
                              mode="advanced"                                          
                              dragDropSupport="true"
                              multiple="false"
                              update=":header:formTemplateLinks:i_logo"
                              immediate="true"
                              fileUploadListener="#{configuracaoBean.upload}"
                              oncomplete="PF('dlg_logo').hide()" />
            </p:dialog>
        </h:form>         
        <h:form id="formTemplateLinks" onsubmit="#{chamadaPaginaBean.controleLinks}">
            <!-- TELA COM 1200px -->
            <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                <h:graphicImage id="i_logo_update" value="/Cliente/#{controleUsuarioBean.clienteString}/Imagens/LogoCliente.png" width="120px" style="float: left; cursor: pointer; border: 2px dashed gray;" onclick="PF('dlg_logo').show();" title="Alterar imagem" alt="Pesquisar uma imagem" rendered="#{configuracaoBean.usuario.id == 1}"/>
                <h:graphicImage id="i_logo" value="/Cliente/#{controleUsuarioBean.clienteString}/Imagens/LogoCliente.png" width="120px" style="float: left" rendered="#{configuracaoBean.usuario.id != 1}"/>
                <p:panel style="float: right; border: 0px; top:0px">
                    <h:outputLabel value="Bem vindo " style="float: left; font-size: 10pt; margin-left: 50px"/>
                    <h:outputLabel value="#{controleUsuarioBean.login}" style="float: left; margin-left: 5px; font-size: 10pt; font-weight: bold;" title="#{controleUsuarioBean.historicoAcesso}"/>
                    <p:commandLink value="Sair" action="#{usuarioBean.sairSistema}" title="Desejo mesmo sair do Sistema?" style="float: right; font-weight: bold; margin-left: 20px" immediate="true"/>
                    <br /><br />
                    <p:outputLabel value="#{controleUsuarioBean.filial}" style="color: #bc4763; font-size: 10pt;  margin-left: 50px; "/>
                </p:panel>
                <h:column rendered="true">
                    <div class="clear"></div>
                    <p:breadCrumb style="background: #dbeaeb; margin-top: 0px">
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento0}" action="#{chamadaPaginaBean.clickNivelLink0}" title="Ir ao Menu Principal" immediate="true" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento0}" action="#{chamadaPaginaBean.clickNivelLink0}" style="font-weight: bold;" title="Ir ao Menu Principal" immediate="true" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento1}" action="#{chamadaPaginaBean.clickNivelLink1}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render1}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento2}" action="#{chamadaPaginaBean.clickNivelLink2}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render2}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento3}" action="#{chamadaPaginaBean.clickNivelLink3}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render3}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento4}" action="#{chamadaPaginaBean.clickNivelLink4}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render4}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento5}" action="#{chamadaPaginaBean.clickNivelLink5}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render5}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento6}" action="#{chamadaPaginaBean.clickNivelLink6}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render6}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento7}" action="#{chamadaPaginaBean.clickNivelLink7}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render7}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento8}" action="#{chamadaPaginaBean.clickNivelLink8}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render8}" ajax="false"/>
                        <p:menuitem value="#{chamadaPaginaBean.dtObjectLabel.argumento9}" action="#{chamadaPaginaBean.clickNivelLink9}" title="Atualiza Página" immediate="true" rendered="#{chamadaPaginaBean.render9}" ajax="false"/>
                    </p:breadCrumb>
                    <p:selectBooleanCheckbox value="#{controleUsuarioBean.habilitaLog}" rendered="#{segurancaUtilitariosBean.sessaoUsuario.id == 1}" itemLabel="Exibir exceções">
                        <p:ajax update="@this :header:form_log" />
                    </p:selectBooleanCheckbox>
                    <p:selectBooleanCheckbox value="#{controleUsuarioBean.habilitaDebugQuery}" rendered="#{segurancaUtilitariosBean.sessaoUsuario.id == 1}" itemLabel="Debug Query" title="Se houver configuração no Bean" styleClass="margin-left-max">
                        <p:ajax update="@this :header:form_debug_query" />
                    </p:selectBooleanCheckbox>
                    <h:panelGrid style="float: right" columns="2">
                        <p:menuButton value="Opções" >
                            <p:menuitem value="Meu Perfil" action="#{chamadaPaginaBean.usuarioPerfil}" />
                            <p:menuitem value="Resolução" onclick="PF('dlg_resolucao').show()"/>
                            <p:menuitem value="Meus Logs" action="#{chamadaPaginaBean.pesquisa('pesquisaLog', 'rotinaPesquisaLog', segurancaUtilitariosBean.rotina.id, 'pesquisaLogBean')}"  />
                            <p:menuitem value="Informar Bug" onclick="PF('dlg_report_bug').show()" />
                            <p:menuitem value="Rotinas Vínculadas" action="#{rotinaBean.loadShowRotinas}" onclick="PF('dlg_show_rotinas').show()" update=":header:form_show_rotinas:i_list_show_rotinas" />
                            <p:menuitem value="Relação de Erros" onclick="PF('dlg_show_erros').show()" update=":header:form_show_erros:i_list_show_erros" />
                            <p:menuitem value="Emails" icon="ui-icon-mail-open" action="#{chamadaPaginaBean.pesquisa('email')}" title="Ver emails enviados" actionListener="#{emailBean.showEmailRotina(-1)}"/>
                            <p:menuitem ajax="false" value="Trocar Filial" action="#{chamadaPaginaBean.pagina('macFilial')}" immediate="true" rendered="#{segurancaUtilitariosBean.sessaoUsuario.id == 1}" styleClass="font-color-red" actionListener="#{genericaSessao.putBoolean('back', true)}"/>
                            <p:separator />
                            <p:menuitem value="Sair" action="#{usuarioBean.sairSistema}" icon="ui-icon-extlink"/>
                        </p:menuButton>
                        <p:commandButton actionListener="#{segurancaUtilitariosBean.enableWebCam}" action="#{chamadaPaginaBean.currentPage}" styleClass="margin-left-max" icon="photocam" style="#{segurancaUtilitariosBean.macFilial.webcam ? 'background: #00ff00' : 'background: #cccccc'};" title="#{segurancaUtilitariosBean.macFilial.webcam ? 'Webcam Ativa' : 'Webcam Desabilitada'}" />

                    </h:panelGrid>
                </h:column>
                <h:column rendered="false">
                    <div class="clear"></div>
                    <div style="background: red; height: 15px; width: 100%; display: block">
                        <p:dataList var="menuLinks" value="#{chamadaPaginaBean.menuLinks}" rowIndexVar="it" type="definition" >
                            <h:column>
                                <h:outputLabel value=" / " title="Voltar um nível" rendered="#{menuLinks.descricao ne 'Menu Principal'}"/>
                                <h:commandLink value="#{menuLinks.descricao}" title="#{menuLinks.descricao}" action="#{chamadaPaginaBean.cliqueMenuLinks(it)}" rendered="#{menuLinks.ativo}" immediate="true"/> 
                            </h:column>
                        </p:dataList>
                    </div>
                </h:column>
            </p:panel>
        </h:form>
        <h:form id="form_debug_query">
            <h:column rendered="#{segurancaUtilitariosBean.sessaoUsuario.id == 1}">
                <h:column rendered="#{controleUsuarioBean.habilitaDebugQuery}">
                    <p:poll global="false" delay="5" interval="5" update="i_poll_debug_query i_exist_debug_query" id="i_poll_debug_query" partialSubmit="true" />
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}" id="i_exist_debug_query" >
                        <h:panelGroup id="i_btn_debug_query">
                            <p:commandButton value="Query" oncomplete="PF('dlg_habilita_debug_query').show()" action="#{debugs.show('habilitaDebugQuery')}" rendered="#{debugs.getExists('habilitaDebugQuery')}" styleClass="font-color-red bold">
                                <p:ajax event="click" update="i_btn_debug_query i_habilita_debug_query" />
                            </p:commandButton>                            
                        </h:panelGroup>
                    </p:panel>                            
                    <p:dialog widgetVar="dlg_habilita_debug_query" header="Query gerada" width="600" height="600" dynamic="true">
                        <p:ajax event="close" update="@form" listener="#{debugs.remove}" />
                        <h:panelGroup id="i_habilita_debug_query">                        
                            <h:inputTextarea value="#{debugs.sessionDebugs}" style="width: 100%; height: 500px;"/>
                        </h:panelGroup>
                    </p:dialog>
                </h:column>
            </h:column>
        </h:form>
        <p:dialog widgetVar="dlg_resolucao" header="Configurar Resolução do Sistema" resizable="false" modal="true" width="400">
            <h:form id="formResolucao">
                <h:panelGrid style="margin-top: 20px; clear: both" columns="3">
                    <h:column>
                        <p:outputLabel value="Resolução: " style="font-size: 11pt!important"/>
                    </h:column>
                    <h:column>
                        <p:selectOneMenu value="#{configuracaoBean.indexTipoResolucao}">
                            <p:ajax event="change" update="@this" global="false"/>
                            <f:selectItems value="#{configuracaoBean.listaTipoResolucao}" />
                        </p:selectOneMenu>
                    </h:column>
                    <h:column>
                        <p:commandButton value="OK" action="#{configuracaoBean.salvarResolucao}"/>
                    </h:column>
                </h:panelGrid>
            </h:form>
        </p:dialog>
        <h:form id="form_show_rotinas">
            <p:dialog widgetVar="dlg_show_rotinas" header="Rotinas vínculadas a está página" resizable="false" modal="true" width="600">
                <h:panelGroup layout="block" id="i_list_show_rotinas">
                    <p:dataTable var="grupoRotina" value="#{rotinaBean.listShowRotinas}" emptyMessage="Nenhum registro encontrado" rows="10" paginator="true" rowIndexVar="index" styleClass="margin-top-max"> 
                        <p:column headerText="Rotina">
                            <p:outputLabel value="#{grupoRotina.rotina.rotina}" styleClass="#{grupoRotina.id == null ? 'bold font-color-red' : ''}"/>
                        </p:column>
                        <p:column headerText="I" styleClass="text-center" width="25">
                            <p:selectBooleanCheckbox value="#{grupoRotina.rotina.inclusao}" disabled="true" />
                        </p:column>
                        <p:column headerText="E" styleClass="text-center" width="25">
                            <p:selectBooleanCheckbox value="#{grupoRotina.rotina.exclusao}" disabled="true" />
                        </p:column>
                        <p:column headerText="A" styleClass="text-center" width="25">
                            <p:selectBooleanCheckbox value="#{grupoRotina.rotina.alteracao}" disabled="true" />
                        </p:column>
                        <p:column headerText="C" styleClass="text-center" width="25">
                            <p:selectBooleanCheckbox value="#{grupoRotina.rotina.consulta}" disabled="true" />
                        </p:column>
                    </p:dataTable>                    
                </h:panelGroup>
            </p:dialog>
        </h:form>
        <h:form id="form_show_erros">
            <p:dialog widgetVar="dlg_show_erros" header="Rotinas vínculadas a está página" resizable="false" modal="true" width="600">
                <h:panelGroup layout="block" id="i_list_show_erros">
                    <p:dataTable var="erros" value="#{menuPrincipalBean.listErros}" emptyMessage="Nenhum registro encontrado" rows="10" paginator="true" rowIndexVar="index" styleClass="margin-top-max"> 
                        <p:column headerText="CÓD." width="30" styleClass="text-center ">
                            <p:outputLabel value="#{erros.id}" styleClass="font-size-12 bold"/>
                        </p:column>                        
                        <p:column headerText="ERRO">
                            <p:outputLabel value="#{erros.descricao}" />
                        </p:column>                        
                    </p:dataTable>
                </h:panelGroup>
                <f:facet name="footer">
                    <h:panelGrid>
                        <p:commandButton action="#{menuPrincipalBean.printErros()}" value="RELAÇÃO DE ERROS" icon="ui-icon-print" ajax="false" />                        
                    </h:panelGrid>
                </f:facet>
            </p:dialog>
        </h:form>
        <h:form id="form_report_bug">
            <p:dialog widgetVar="dlg_report_bug" header="Reportar Bug" resizable="false" modal="true" width="640">
                <p:messages id="i_message" showDetail="true" showSummary="true" closable="true" />
                <p:panel>
                    <p:inputTextarea value="#{reportBugBean.bug}" cols="90" rows="10" placeholder="Informe o problema ocorrido, deve conter no mínimo 10 caracteres" id="id_bug" disabled="#{reportBugBean.success}">
                        <p:ajax event="change" update="@this id_report id_anexo" />
                    </p:inputTextarea>
                    <f:facet name="footer">
                        <h:panelGrid columns="2" id="id_anexo">
                            <p:commandButton action="#{reportBugBean.report}" value="Enviar" id="id_report" update="id_bug id_anexo i_message" disabled="#{reportBugBean.success}"/>
                            <p:commandButton value="#{reportBugBean.fileBug == null ? 'Anexar arquivo' : 'Arquivo anexado' } " onclick="PF('dlg_anexo_bug').show();" type="button" disabled="#{10 > reportBugBean.bug.length() or reportBugBean.success}" />
                        </h:panelGrid>
                    </f:facet>                    
                </p:panel>
            </p:dialog>
            <p:dialog widgetVar="dlg_anexo_bug" modal="true"  header="Anexar arquivo" closable="true">
                <p:fileUpload label="Procurar"
                              cancelLabel="Cancelar"
                              uploadLabel="Anexar"
                              mode="advanced"                                          
                              dragDropSupport="true"
                              multiple="false"
                              immediate="true"
                              update="id_anexo"
                              fileUploadListener="#{reportBugBean.upload}"
                              oncomplete="PF('dlg_anexo_bug').hide()" />
            </p:dialog>
        </h:form>
    </f:view>    
</html>